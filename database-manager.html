<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ReadAI Database Manager</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #9ca3af;
            font-size: 1.1rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #6366f1;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #9ca3af;
            font-size: 1rem;
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .action-btn {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border: none;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.3);
        }
        
        .action-btn.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .action-btn.danger:hover {
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
        }
        
        .log {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin-bottom: 10px;
            padding: 5px 0;
        }
        
        .log-entry.success {
            color: #10b981;
        }
        
        .log-entry.error {
            color: #ef4444;
        }
        
        .log-entry.info {
            color: #3b82f6;
        }
        
        .category-breakdown {
            margin-top: 40px;
        }
        
        .category-breakdown h3 {
            color: #6366f1;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }
        
        .category-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .category-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        
        .category-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .category-count {
            color: #9ca3af;
            font-size: 0.9rem;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö ReadAI Database Manager</h1>
            <p>Manage your book database with thousands of books across all categories</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalBooks">0</div>
                <div class="stat-label">Total Books</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCategories">0</div>
                <div class="stat-label">Categories</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="lastUpdated">-</div>
                <div class="stat-label">Last Updated</div>
            </div>
        </div>
        
        <div class="actions">
            <button class="action-btn" onclick="loadStats()">üìä Refresh Stats</button>
            <button class="action-btn" onclick="populateDatabase()">üöÄ Populate Database</button>
            <button class="action-btn" onclick="showSampleBooks()">üëÄ View Sample Books</button>
            <button class="action-btn danger" onclick="clearDatabase()">üóëÔ∏è Clear Database</button>
        </div>
        
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>
        
        <div class="log" id="log">
            <div class="log-entry info">üìö ReadAI Database Manager Ready</div>
            <div class="log-entry info">Click "Refresh Stats" to see current database status</div>
        </div>
        
        <div class="category-breakdown" id="categoryBreakdown" style="display: none;">
            <h3>üìñ Books by Category</h3>
            <div class="category-list" id="categoryList"></div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        // Security: Using new secure API keys
        const SUPABASE_URL = 'https://ycjmdtitrmxcnekntjcj.supabase.co';
        const SUPABASE_ANON_KEY = 'sb_publishable_hLt2hs3ApCQdW8WC-EX4QQ_ePx7W6S6';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // Book database (simplified version for demo)
        const sampleBooks = [
            // Classic Literature
            { title: "Pride and Prejudice", author: "Jane Austen", year: 1813, category: "Classic Literature", description: "A romantic novel about Elizabeth Bennet and Mr. Darcy in Georgian England." },
            { title: "The Great Gatsby", author: "F. Scott Fitzgerald", year: 1925, category: "Classic Literature", description: "A tale of the fabulously wealthy Jay Gatsby and his love for Daisy Buchanan." },
            { title: "To Kill a Mockingbird", author: "Harper Lee", year: 1960, category: "Classic Literature", description: "A story of racial injustice and childhood innocence in the American South." },
            
            // Science Fiction
            { title: "Dune", author: "Frank Herbert", year: 1965, category: "Science Fiction", description: "An epic space opera about politics, religion, and ecology on a desert planet." },
            { title: "Foundation", author: "Isaac Asimov", year: 1951, category: "Science Fiction", description: "A series about psychohistory and the fall of a galactic empire." },
            { title: "The Hitchhiker's Guide to the Galaxy", author: "Douglas Adams", year: 1979, category: "Science Fiction", description: "A comedic science fiction novel about the end of the world." },
            
            // Fantasy
            { title: "The Lord of the Rings", author: "J.R.R. Tolkien", year: 1954, category: "Fantasy", description: "An epic fantasy trilogy about the quest to destroy the One Ring." },
            { title: "A Game of Thrones", author: "George R.R. Martin", year: 1996, category: "Fantasy", description: "The first book in A Song of Ice and Fire series." },
            { title: "The Name of the Wind", author: "Patrick Rothfuss", year: 2007, category: "Fantasy", description: "The first book in The Kingkiller Chronicle series." },
            
            // Mystery
            { title: "The Murder of Roger Ackroyd", author: "Agatha Christie", year: 1926, category: "Mystery", description: "A Hercule Poirot mystery with a famous twist ending." },
            { title: "The Girl with the Dragon Tattoo", author: "Stieg Larsson", year: 2005, category: "Mystery", description: "A mystery about a journalist and a hacker investigating a disappearance." },
            { title: "Gone Girl", author: "Gillian Flynn", year: 2012, category: "Mystery", description: "A psychological thriller about a missing wife." },
            
            // Biography
            { title: "Long Walk to Freedom", author: "Nelson Mandela", year: 1994, category: "Biography", description: "The autobiography of Nelson Mandela, South Africa's first black president." },
            { title: "The Diary of a Young Girl", author: "Anne Frank", year: 1947, category: "Biography", description: "The diary of Anne Frank, a Jewish girl hiding during the Holocaust." },
            { title: "Steve Jobs", author: "Walter Isaacson", year: 2011, category: "Biography", description: "A biography of the co-founder of Apple Inc." },
            
            // Comedy
            { title: "Catch-22", author: "Joseph Heller", year: 1961, category: "Comedy", description: "A satirical novel about the absurdity of war and bureaucracy." },
            { title: "Good Omens", author: "Terry Pratchett & Neil Gaiman", year: 1990, category: "Comedy", description: "A comedic novel about the apocalypse and an angel and demon trying to stop it." },
            { title: "Bossypants", author: "Tina Fey", year: 2011, category: "Comedy", description: "Tina Fey's memoir about her life and career in comedy." },
            
            // Horror
            { title: "Dracula", author: "Bram Stoker", year: 1897, category: "Horror", description: "A gothic horror novel about Count Dracula and his attempt to move to England." },
            { title: "The Shining", author: "Stephen King", year: 1977, category: "Horror", description: "A psychological horror novel about a writer who becomes caretaker of a haunted hotel." },
            { title: "It", author: "Stephen King", year: 1986, category: "Horror", description: "A horror novel about a shape-shifting entity that preys on children." },
            
            // Fiction
            { title: "The Kite Runner", author: "Khaled Hosseini", year: 2003, category: "Fiction", description: "A novel about friendship, betrayal, and redemption in Afghanistan." },
            { title: "The Book Thief", author: "Markus Zusak", year: 2005, category: "Fiction", description: "A novel about a young girl in Nazi Germany who steals books." },
            { title: "The Help", author: "Kathryn Stockett", year: 2009, category: "Fiction", description: "A novel about African American maids in 1960s Mississippi." },
            
            // Non-Fiction
            { title: "The 7 Habits of Highly Effective People", author: "Stephen R. Covey", year: 1989, category: "Non-Fiction", description: "A self-help book about personal and professional effectiveness." },
            { title: "Sapiens", author: "Yuval Noah Harari", year: 2011, category: "Non-Fiction", description: "A history book about the evolution of human society." },
            { title: "Atomic Habits", author: "James Clear", year: 2018, category: "Non-Fiction", description: "A self-help book about building good habits and breaking bad ones." },
            
            // Cooking
            { title: "The Joy of Cooking", author: "Irma S. Rombauer", year: 1931, category: "Cooking", description: "A comprehensive cookbook covering all aspects of cooking." },
            { title: "Mastering the Art of French Cooking", author: "Julia Child", year: 1961, category: "Cooking", description: "A cookbook that introduced French cuisine to American home cooks." },
            { title: "Salt, Fat, Acid, Heat", author: "Samin Nosrat", year: 2017, category: "Cooking", description: "A cookbook about the four fundamental elements of good cooking." }
        ];
        
        // Logging functions
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            logElement.appendChild(entry);
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        
        // Load database statistics
        async function loadStats() {
            showLoading(true);
            log('üìä Loading database statistics...', 'info');
            
            try {
                const { data, error } = await supabase
                    .from('books')
                    .select('*');
                
                if (error) {
                    log(`‚ùå Error loading stats: ${error.message}`, 'error');
                    return;
                }
                
                const totalBooks = data.length;
                const categories = [...new Set(data.map(book => book.category))];
                const categoryCounts = {};
                
                data.forEach(book => {
                    categoryCounts[book.category] = (categoryCounts[book.category] || 0) + 1;
                });
                
                // Update stats display
                document.getElementById('totalBooks').textContent = totalBooks;
                document.getElementById('totalCategories').textContent = categories.length;
                document.getElementById('lastUpdated').textContent = new Date().toLocaleTimeString();
                
                // Show category breakdown
                const categoryBreakdown = document.getElementById('categoryBreakdown');
                const categoryList = document.getElementById('categoryList');
                categoryList.innerHTML = '';
                
                Object.entries(categoryCounts).forEach(([category, count]) => {
                    const categoryItem = document.createElement('div');
                    categoryItem.className = 'category-item';
                    categoryItem.innerHTML = `
                        <div class="category-name">${category}</div>
                        <div class="category-count">${count} books</div>
                    `;
                    categoryList.appendChild(categoryItem);
                });
                
                categoryBreakdown.style.display = 'block';
                
                log(`‚úÖ Loaded ${totalBooks} books across ${categories.length} categories`, 'success');
                
            } catch (error) {
                log(`üí• Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // Populate database with sample books
        async function populateDatabase() {
            showLoading(true);
            log('üöÄ Starting database population...', 'info');
            
            try {
                // Insert books in batches
                const batchSize = 10;
                let successCount = 0;
                let errorCount = 0;
                
                for (let i = 0; i < sampleBooks.length; i += batchSize) {
                    const batch = sampleBooks.slice(i, i + batchSize);
                    log(`üì¶ Processing batch ${Math.floor(i / batchSize) + 1}/${Math.ceil(sampleBooks.length / batchSize)}`, 'info');
                    
                    const { data, error } = await supabase
                        .from('books')
                        .insert(batch);
                    
                    if (error) {
                        log(`‚ùå Error in batch: ${error.message}`, 'error');
                        errorCount += batch.length;
                    } else {
                        log(`‚úÖ Added batch ${Math.floor(i / batchSize) + 1}`, 'success');
                        successCount += batch.length;
                    }
                    
                    // Small delay between batches
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                log(`üéâ Population complete! Added ${successCount} books, ${errorCount} errors`, 'success');
                
                // Refresh stats
                await loadStats();
                
            } catch (error) {
                log(`üí• Fatal error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // Show sample books
        function showSampleBooks() {
            log('üëÄ Sample books available for population:', 'info');
            sampleBooks.forEach((book, index) => {
                log(`${index + 1}. ${book.title} by ${book.author} (${book.category})`, 'info');
            });
        }
        
        // Clear database
        async function clearDatabase() {
            if (!confirm('‚ö†Ô∏è WARNING: This will delete ALL books from the database! Are you sure?')) {
                return;
            }
            
            showLoading(true);
            log('üóëÔ∏è Clearing database...', 'info');
            
            try {
                const { error } = await supabase
                    .from('books')
                    .delete()
                    .neq('id', 0);
                
                if (error) {
                    log(`‚ùå Error clearing database: ${error.message}`, 'error');
                } else {
                    log('‚úÖ Database cleared successfully', 'success');
                    await loadStats();
                }
            } catch (error) {
                log(`üí• Error: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            log('üìö ReadAI Database Manager initialized', 'info');
            log('üí° Click "Refresh Stats" to see current database status', 'info');
        });
    </script>
</body>
</html>
